# راهنمای سریع: آپلود PDF کتاب

## تنظیم اولیه

این فیچر به‌طور خودکار کار می‌کند و نیازی به تنظیم اضافی ندارد.

### فایل‌های اضافه شده:

#### Backend (pishro2):
1. **`app/api/admin/books/upload-pdf/route.ts`**
   - اندپوینت API برای آپلود PDF
   - اعتبارسنجی و ذخیره فایل

#### Frontend (pishro-admin2):
1. **`src/lib/services/book-pdf-service.ts`**
   - سرویس کلاینت برای آپلود
   - مدیریت خطا

2. **`src/components/Books/BookForm.tsx`** (بروزرسانی شده)
   - UI برای انتخاب و آپلود PDF
   - مدیریت state و بارگیری

#### Documentation:
1. **`docs/BOOK_PDF_UPLOAD_GUIDE.md`** (این فایل)

## نحوه استفاده

### مرحله 1: وارد پنل ادمین شوید
```
https://your-domain.com/admin/books
```

### مرحله 2: کتاب جدید یا ویرایش کتاب
- برای کتاب جدید: روی "افزودن کتاب جدید" کلیک کنید
- برای ویرایش: روی کتابی کلیک کنید

### مرحله 3: فایل PDF را آپلود کنید
1. به قسمت "آپلود فایل PDF" بروید
2. روی دکمه "کلیک برای انتخاب PDF" کلیک کنید
3. فایل PDF خود را انتخاب کنید
4. منتظر بمانید (پیام "در حال آپلود..." نمایش داده می‌شود)
5. پس از تکمیل، پیام "✓ آپلود شده: [نام فایل]" نمایش داده می‌شود

### مرحله 4: فرم را ذخیره کنید
- سایر فیلد‌های مورد نیاز را پر کنید
- روی دکمه "ذخیره" کلیک کنید

## خطاهای رایج و حل‌ها

### خطا: "فقط فایل‌های PDF مجاز است"
✓ **حل:** اطمینان حاصل کنید که فایل دارای پسوند `.pdf` است

### خطا: "حجم فایل بیش از حد است. حداکثر 100MB مجاز است."
✓ **حل:** فایل PDF خود را کمپرس کنید

### خطا: "لطفاً وارد حساب کاربری خود شوید"
✓ **حل:** مجدداً وارد سایت شوید

### خطا: "دسترسی غیرمجاز - فقط ادمین"
✓ **حل:** این فیچر فقط برای ادمین‌ها در دسترس است

## مشخصات فنی

| مشخصه | مقدار |
|------|--------|
| **حداکثر اندازه فایل** | 100 MB |
| **فرمت‌های پذیرفته‌شده** | PDF فقط |
| **نمونه URL** | `/uploads/books/pdfs/book_1702876543210_abc123.pdf` |
| **نوع احراز هویت** | Session Cookie |
| **سطح دسترسی** | فقط ادمین |

## نکات مهم

✓ فایل‌های آپلود شده به‌صورت public در `public/uploads/books/pdfs/` ذخیره می‌شود  
✓ نام فایل‌ها به‌صورت تصادفی نام‌گذاری می‌شوند تا از برخورد جلوگیری شود  
✓ URL فایل به‌طور خودکار در فیلد `fileUrl` ذخیره می‌شود  
✓ می‌توانید فایل را تغییر دهید تا آخرین فایل تعویض شود  

## مثال عملی

```
1. به قسمت "کتاب‌ها" > "افزودن کتاب جدید" بروید
2. فیلد‌های زیر را پر کنید:
   - عنوان: "برنامه‌نویسی Python"
   - نویسنده: "احمد محمدی"
   - توضیحات: "کتابی جامع درباره Python"
   - دسته‌بندی: "برنامه‌نویسی"
3. به قسمت "آپلود فایل PDF" بروید
4. روی دکمه "کلیک برای انتخاب PDF" کلیک کنید
5. فایل "python-book.pdf" را انتخاب کنید
6. منتظر بمانید تا آپلود تکمیل شود
7. روی دکمه "ذخیره" کلیک کنید
8. کتاب ایجاد شده و PDF آپلود شده است ✓
```

## سوالات متکررر

**Q: آیا می‌توانم PDF را بعداً تغییر دهید؟**  
A: بله، می‌توانید روی دکمه "✕" کلیک کنید و PDF جدیدی انتخاب کنید.

**Q: فایل قدیمی به‌جای جدید باقی می‌ماند؟**  
A: خیر، فایل قدیمی در سرور باقی می‌ماند اما در دیتابیس URL نسخه جدید ذخیره می‌شود.

**Q: آیا می‌توانم دو PDF برای یک کتاب داشته باشم؟**  
A: خیر، هر کتاب فقط یک فایل PDF می‌تواند داشته باشد. اگر نیاز دارید می‌توانید جلدی دیگر ایجاد کنید.

**Q: چه اتفاقی می‌افتد اگر آپلود قطع شود؟**  
A: اگر اتصال قطع شود، دوباره تلاش کنید. فایل نیمه‌تمام در سرور حذف نخواهد شد.

## پشتیبانی

برای مسائل فنی:
1. کنسول مرورگر (F12 > Console) را بررسی کنید
2. Network tab را برای خطاهای HTTP بررسی کنید
3. لاگ‌های سرور را بررسی کنید

---

**نسخه:** 1.0.0  
**آخرین بروزرسانی:** 18 دسامبر 2024
