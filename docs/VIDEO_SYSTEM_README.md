# Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒØ¯ÛŒÙˆ - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ØµØ¨ Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ù…Ø¹Ø±ÙÛŒ](#Ù…Ø¹Ø±ÙÛŒ)
2. [ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§](#ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§)
3. [Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…](#Ù…Ø¹Ù…Ø§Ø±ÛŒ-Ø³ÛŒØ³ØªÙ…)
4. [Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ](#Ù†ØµØ¨-Ùˆ-Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ)
5. [Ø§Ø³ØªÙØ§Ø¯Ù‡](#Ø§Ø³ØªÙØ§Ø¯Ù‡)
6. [API Documentation](#api-documentation)
7. [Ø§Ù…Ù†ÛŒØª](#Ø§Ù…Ù†ÛŒØª)
8. [Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ](#Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ)

---

## Ù…Ø¹Ø±ÙÛŒ

Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒØ¯ÛŒÙˆÛŒ Ø¬Ø§Ù…Ø¹ Ø¨Ø±Ø§ÛŒ Ù¾Ù„ØªÙØ±Ù… Ø¢Ù…ÙˆØ²Ø´ÛŒ Ú©Ù‡ Ø´Ø§Ù…Ù„:

- Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ù…Ù† ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø² CMS
- ØªØ¨Ø¯ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ HLS (Adaptive Bitrate Streaming)
- Ù¾Ø®Ø´ Ø§Ù…Ù† Ø¨Ø§ Ø³ÛŒØ³ØªÙ… ØªÙˆÚ©Ù†â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú†Ù†Ø¯ Ù„Ø§ÛŒÙ‡
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø§ IDM Ùˆ download managers

---

## ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

### âœ¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ

1. **Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ù…Ù†:**

   - Signed Upload URL Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø± Ù…Ø­Ø¯ÙˆØ¯
   - Ø¢Ù¾Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ù‡ Object Storage
   - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØ§ 5GB

2. **ØªØ¨Ø¯ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ HLS:**

   - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ú†Ù†Ø¯ Ú©ÛŒÙÛŒØª (360p, 720p, 1080p)
   - ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± thumbnail
   - Segment duration Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…

3. **Ø§Ù…Ù†ÛŒØª Ù¾Ø®Ø´:**

   - ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª (30 Ø«Ø§Ù†ÛŒÙ‡)
   - Signed URLs Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ HLS
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø¯ÙˆØ±Ù‡

4. **Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ø§Ù…Ø¹:**
   - CRUD Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§
   - Ø±Ø¯ÛŒØ§Ø¨ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø²Ø´
   - Ù†Ù…Ø§ÛŒØ´ progress Ø¯Ø± CMS

---

## Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ù…Ø±ÙˆØ±Ú¯Ø±    â”‚
â”‚   Ù…Ø¯ÛŒØ± CMS  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Ø¯Ø±Ø®ÙˆØ§Ø³Øª Upload URL
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js Backend       â”‚
â”‚   /api/admin/videos/    â”‚
â”‚   upload-url            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. ØªÙˆÙ„ÛŒØ¯ Signed URL
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Object Storage        â”‚
â”‚   (S3-compatible)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. Ø¢Ù¾Ù„ÙˆØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… ÙØ§ÛŒÙ„
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FFmpeg Worker         â”‚
â”‚   ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ HLS          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Ø°Ø®ÛŒØ±Ù‡ HLS files
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database (MongoDB)    â”‚
â”‚   Ø°Ø®ÛŒØ±Ù‡ metadata        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ú©Ø§Ø±Ø¨Ø±     â”‚
â”‚   Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Ø¯Ø±Ø®ÙˆØ§Ø³Øª ØªÙˆÚ©Ù†
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /api/video/token      â”‚
â”‚   Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ         â”‚
â”‚   ØªÙˆÙ„ÛŒØ¯ ØªÙˆÚ©Ù† 30 Ø«Ø§Ù†ÛŒÙ‡  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 2. ØªÙˆÚ©Ù†
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HLS.js Player         â”‚
â”‚   Ø¯Ø±Ø®ÙˆØ§Ø³Øª playlist      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. /api/video/stream/[id]/index.m3u8?token=xxx
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Stream Proxy API      â”‚
â”‚   Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆÚ©Ù†      â”‚
â”‚   Ø¨Ø§Ø²Ú¯Ø´Øª playlist       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ù†ØµØ¨ Ùˆ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ

### 1. Ù†ØµØ¨ Dependencies

```bash
# Ù†ØµØ¨ AWS SDK Ø¨Ø±Ø§ÛŒ Object Storage
npm install @aws-sdk/client-s3 @aws-sdk/s3-request-presigner

# Ù†ØµØ¨ HLS.js Ø¨Ø±Ø§ÛŒ Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ
npm install hls.js

# Ù†ØµØ¨ ØªØ§ÛŒÙ¾â€ŒÙ‡Ø§
npm install -D @types/hls.js
```

### 2. Ù†ØµØ¨ FFmpeg

FFmpeg Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ù‡ HLS Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª.

**Ubuntu/Debian:**

```bash
sudo apt update
sudo apt install ffmpeg
```

**macOS:**

```bash
brew install ffmpeg
```

**Docker:**

```dockerfile
FROM node:18-alpine

# Ù†ØµØ¨ FFmpeg
RUN apk add --no-cache ffmpeg

# Ø¨Ø§Ù‚ÛŒ Dockerfile...
```

**Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨:**

```bash
ffmpeg -version
ffprobe -version
```

### 3. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Environment Variables

ÙØ§ÛŒÙ„ `.env` Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø§ÛŒÙ† Ù…ØªØºÛŒØ±Ù‡Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯:

```env
# Object Storage (S3-compatible)
S3_REGION=default
S3_ENDPOINT=https://s3.ir-thr-at1.iranServerstorage.ir  # for iranServer Cloud
S3_ACCESS_KEY_ID=your-access-key
S3_SECRET_ACCESS_KEY=your-secret-key
S3_BUCKET_NAME=your-bucket-name
S3_PUBLIC_ENDPOINT=https://your-bucket.s3.ir-thr-at1.iranServerstorage.ir

# Video Token Secret
VIDEO_TOKEN_SECRET=your-very-strong-secret-key-here-min-32-chars

# Temporary Directory Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´
TEMP_DIR=/tmp/video-processing

# Database
DATABASE_URL=mongodb://...
```

### 4. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Object Storage

#### Ø¨Ø±Ø§ÛŒ iranServer Cloud:

1. ÙˆØ§Ø±Ø¯ Ù¾Ù†Ù„ iranServer Ø´ÙˆÛŒØ¯
2. Ø¨Ø®Ø´ Cloud Storage â†’ Ø§ÛŒØ¬Ø§Ø¯ Bucket Ø¬Ø¯ÛŒØ¯
3. Ø¯Ø±ÛŒØ§ÙØª Access Key Ùˆ Secret Key
4. ØªÙ†Ø¸ÛŒÙ… CORS:

```json
[
  {
    "AllowedOrigins": ["*"],
    "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3600
  }
]
```

#### Ø¨Ø±Ø§ÛŒ Liara Object Storage:

```env
S3_ENDPOINT=https://storage.iran.liara.space
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=your-liara-access-key
S3_SECRET_ACCESS_KEY=your-liara-secret-key
S3_BUCKET_NAME=your-bucket-name
```

### 5. Ø§Ø¬Ø±Ø§ÛŒ Migration

```bash
# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯Ù„ Video Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
npx prisma generate
npx prisma db push
```

### 6. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Production

Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· productionØŒ Ø¨Ø§ÛŒØ¯ ÛŒÚ© worker Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯:

**Option 1: Cron Job**

```bash
# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ crontab
*/5 * * * * node /path/to/video-processor-worker.js
```

**Option 2: Queue System (Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ)**

```bash
npm install bull redis
```

---

## Ø§Ø³ØªÙØ§Ø¯Ù‡

### 1. Ø¢Ù¾Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø² CMS

```tsx
import { VideoUploader } from "@/components/admin/videoUploader";

export default function AdminPage() {
  return (
    <VideoUploader
      onUploadComplete={(video) => {
        console.log("ÙˆÛŒØ¯ÛŒÙˆ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯:", video);
        // Redirect ÛŒØ§ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
      }}
      onError={(error) => {
        console.error("Ø®Ø·Ø§:", error);
      }}
    />
  );
}
```

### 2. Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±

```tsx
import { VideoPlayer } from "@/components/video/videoPlayer";

export default function LessonPage({ videoId }: { videoId: string }) {
  return (
    <VideoPlayer
      videoId={videoId}
      autoPlay={false}
      controls={true}
      poster="/thumbnail.jpg"
      className="w-full aspect-video"
      onReady={() => console.log("ÙˆÛŒØ¯ÛŒÙˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª")}
      onError={(error) => console.error("Ø®Ø·Ø§:", error)}
    />
  );
}
```

### 3. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Hooks

```tsx
import { useVideos, useVideo, useDeleteVideo } from "@/lib/hooks/useVideos";

function VideoManagement() {
  // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§
  const { data: videosData, isLoading } = useVideos({
    page: 1,
    limit: 20,
    processingStatus: "READY",
  });

  // Ø¯Ø±ÛŒØ§ÙØª ÛŒÚ© ÙˆÛŒØ¯ÛŒÙˆ
  const { data: video } = useVideo("video-id");

  // Ø­Ø°Ù ÙˆÛŒØ¯ÛŒÙˆ
  const deleteMutation = useDeleteVideo();

  const handleDelete = (videoId: string) => {
    deleteMutation.mutate(videoId);
  };

  // ...
}
```

---

## API Documentation

### 1. Ø¯Ø±ÛŒØ§ÙØª Upload URL

**Endpoint:** `POST /api/admin/videos/upload-url`

**Authentication:** Admin only

**Request Body:**

```json
{
  "fileName": "my-video.mp4",
  "fileSize": 104857600,
  "fileFormat": "mp4",
  "title": "Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ¯ÛŒÙˆ",
  "description": "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø®ØªÛŒØ§Ø±ÛŒ"
}
```

**Response:**

```json
{
  "status": "success",
  "data": {
    "uploadUrl": "https://...",
    "videoId": "abc123...",
    "storagePath": "videos/abc123/...",
    "expiresAt": 1234567890
  }
}
```

### 2. Ø§ÛŒØ¬Ø§Ø¯ ÙˆÛŒØ¯ÛŒÙˆ

**Endpoint:** `POST /api/admin/videos`

**Request Body:**

```json
{
  "title": "Ø¹Ù†ÙˆØ§Ù† ÙˆÛŒØ¯ÛŒÙˆ",
  "description": "ØªÙˆØ¶ÛŒØ­Ø§Øª",
  "videoId": "abc123",
  "originalPath": "videos/abc123/file.mp4",
  "fileSize": 104857600,
  "fileFormat": "mp4",
  "startProcessing": true
}
```

### 3. Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ù¾Ø®Ø´

**Endpoint:** `POST /api/video/token`

**Authentication:** User must be logged in

**Request Body:**

```json
{
  "videoId": "abc123"
}
```

**Response:**

```json
{
  "status": "success",
  "data": {
    "token": "eyJ...",
    "videoId": "abc123",
    "expiresAt": 1234567890
  }
}
```

### 4. Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ

**Endpoint:** `GET /api/video/stream/[videoId]/index.m3u8?token=xxx`

**Headers:**

- `Range`: Ø¨Ø±Ø§ÛŒ byte-range requests

**Response:**

- `Content-Type: application/vnd.apple.mpegurl`
- Body: Ù…Ø­ØªÙˆØ§ÛŒ m3u8 Ø¨Ø§ URLÙ‡Ø§ÛŒ modify Ø´Ø¯Ù‡

---

## Ø§Ù…Ù†ÛŒØª

### Ø³Ø·Ø­ 1: Signed Upload URLs

- ØªÙˆÙ„ÛŒØ¯ URL Ø¨Ø§ Ø§Ø¹ØªØ¨Ø§Ø± 1 Ø³Ø§Ø¹ØªÙ‡
- ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ù‡Ø¯
- Ù‡Ø± URL ÙÙ‚Ø· ÛŒÚ© Ø¨Ø§Ø± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø³Ø·Ø­ 2: Token Verification

- Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ø®Ø´ØŒ ØªÙˆÚ©Ù† 30 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´ÙˆØ¯
- ØªÙˆÚ©Ù† Ø´Ø§Ù…Ù„ userId Ùˆ videoId Ø§Ø³Øª
- HMAC SHA256 Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø¶Ø§ÛŒ ØªÙˆÚ©Ù†

### Ø³Ø·Ø­ 3: Stream Proxy

- Ù‡Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª playlist Ùˆ segment Ø¨Ø§ÛŒØ¯ ØªÙˆÚ©Ù† Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- ØªÙˆÚ©Ù† Ø¯Ø± server Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² storage Ø®ÙˆØ§Ù†Ø¯Ù‡ Ùˆ proxy Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

### Ø³Ø·Ø­ 4: Access Control

- Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯ÙˆØ±Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
- ÙÙ‚Ø· Ú©Ø§Ø±Ø¨Ø±Ø§Ù† authorized Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø¨ÛŒÙ†Ù†Ø¯

---

## Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ø®Ø·Ø§ÛŒ "FFmpeg not found"

**Ø±Ø§Ù‡â€ŒØ­Ù„:**

```bash
# Ø¨Ø±Ø±Ø³ÛŒ Ù†ØµØ¨
which ffmpeg
which ffprobe

# Ø§Ú¯Ø± Ù†ØµØ¨ Ù†ÛŒØ³Øª:
# Ubuntu/Debian
sudo apt install ffmpeg

# macOS
brew install ffmpeg
```

### Ø®Ø·Ø§ÛŒ "ØªÙˆÚ©Ù† Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡"

**Ø¹Ù„Øª:** Player Ø®ÛŒÙ„ÛŒ Ø¯ÛŒØ± Ø¯Ø±Ø®ÙˆØ§Ø³Øª segment Ø±Ø§ ÙØ±Ø³ØªØ§Ø¯Ù‡

**Ø±Ø§Ù‡â€ŒØ­Ù„:**

- Ø¯Ø± `video-token-service.ts` Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø± Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯:

```ts
const DEFAULT_TOKEN_EXPIRY = 60; // Ø§Ø² 30 Ø¨Ù‡ 60 Ø«Ø§Ù†ÛŒÙ‡
```

### Ø®Ø·Ø§ÛŒ "Access Denied" Ø¯Ø± Object Storage

**Ø±Ø§Ù‡â€ŒØ­Ù„:**

1. Ø¨Ø±Ø±Ø³ÛŒ Access Key Ùˆ Secret Key
2. Ø¨Ø±Ø±Ø³ÛŒ CORS settings Ø¯Ø± bucket
3. Ø¨Ø±Ø±Ø³ÛŒ Bucket Policy

### ÙˆÛŒØ¯ÛŒÙˆ Ø¯Ø± Safari Ù¾Ø®Ø´ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

**Ø¹Ù„Øª:** Safari Ù†ÛŒØ§Ø² Ø¨Ù‡ HTTPS Ø¨Ø±Ø§ÛŒ HLS Ø¯Ø§Ø±Ø¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**

- Ø§Ø² HTTPS Ø¯Ø± production Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
- Ø¨Ø±Ø§ÛŒ development Ø§Ø² `ngrok` ÛŒØ§ `localtunnel` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

### Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙˆÛŒØ¯ÛŒÙˆ Ø®ÛŒÙ„ÛŒ Ø·ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ø´Ø¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**

1. Ú©ÛŒÙÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ù…ØªØ±ÛŒ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ (ÙÙ‚Ø· 360p Ùˆ 720p)
2. `segmentDuration` Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯ (Ø§Ø² 6 Ø¨Ù‡ 10 Ø«Ø§Ù†ÛŒÙ‡)
3. Ø§Ø² server Ù‚ÙˆÛŒâ€ŒØªØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
4. Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±Ø§ Ø¨Ù‡ worker Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù…Ù†ØªÙ‚Ù„ Ú©Ù†ÛŒØ¯

---

## Ù…Ø«Ø§Ù„ Ú©Ø§Ù…Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡

### ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§

```tsx
"use client";

import { useState } from "react";
import { VideoUploader } from "@/components/admin/videoUploader";
import { useVideos, useDeleteVideo } from "@/lib/hooks/useVideos";

export default function VideosManagementPage() {
  const [page, setPage] = useState(1);
  const { data: videosData, isLoading } = useVideos({ page, limit: 10 });
  const deleteMutation = useDeleteVideo();

  const getStatusBadge = (status: string) => {
    const badges = {
      UPLOADING: "Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ø¬Ø§Ù…",
      UPLOADED: "Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡",
      PROCESSING: "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´",
      READY: "Ø¢Ù…Ø§Ø¯Ù‡",
      FAILED: "Ø®Ø·Ø§",
    };
    return badges[status as keyof typeof badges] || status;
  };

  return (
    <div className="container mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">Ù…Ø¯ÛŒØ±ÛŒØª ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§</h1>

      {/* Ø¢Ù¾Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆÛŒ Ø¬Ø¯ÛŒØ¯ */}
      <div className="mb-8">
        <VideoUploader
          onUploadComplete={(video) => {
            alert(`ÙˆÛŒØ¯ÛŒÙˆ "${video.title}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯!`);
          }}
        />
      </div>

      {/* Ù„ÛŒØ³Øª ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ */}
      <div className="bg-white rounded-lg shadow">
        <table className="w-full">
          <thead>
            <tr className="border-b">
              <th className="p-4 text-right">Ø¹Ù†ÙˆØ§Ù†</th>
              <th className="p-4 text-right">ÙˆØ¶Ø¹ÛŒØª</th>
              <th className="p-4 text-right">ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
              <th className="p-4 text-right">Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
          </thead>
          <tbody>
            {videosData?.items.map((video) => (
              <tr key={video.id} className="border-b">
                <td className="p-4">{video.title}</td>
                <td className="p-4">
                  <span className="px-2 py-1 bg-blue-100 rounded">
                    {getStatusBadge(video.processingStatus)}
                  </span>
                </td>
                <td className="p-4">
                  {new Date(video.createdAt).toLocaleDateString("fa-IR")}
                </td>
                <td className="p-4">
                  <button
                    onClick={() => deleteMutation.mutate(video.videoId)}
                    className="text-red-600 hover:text-red-800"
                  >
                    Ø­Ø°Ù
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
```

---

## Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ù…Ø´Ú©Ù„Ø§Øª:

- GitHub Issues: [Ù„ÛŒÙ†Ú© Ø¨Ù‡ repository]
- Email: support@example.com

---

ØªÙ‡ÛŒÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ Ø¨Ø±Ø§ÛŒ Ù¾Ù„ØªÙØ±Ù… Ø¢Ù…ÙˆØ²Ø´ÛŒ Ù¾ÛŒØ´Ø±Ùˆ
